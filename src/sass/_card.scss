@use "mixins/border-radius" as *;
@use "mixins/box-shadow" as *;
@use "mixins/breakpoints" as *;
@use "variables" as *;

/* Base styles */

.card {
    /* card-css-vars */
    --#{$prefix}card-spacer-y: #{$card-spacer-y};
    --#{$prefix}card-spacer-x: #{$card-spacer-x};
    --#{$prefix}card-title-spacer-y: #{$card-title-spacer-y};
    --#{$prefix}card-title-color: #{$card-title-color};
    --#{$prefix}card-subtitle-color: #{$card-subtitle-color};
    --#{$prefix}card-border-width: #{$card-border-width};
    --#{$prefix}card-border-color: #{$card-border-color};
    --#{$prefix}card-border-radius: #{$card-border-radius};
    --#{$prefix}card-box-shadow: #{$card-box-shadow};
    --#{$prefix}card-inner-border-radius: #{$card-inner-border-radius};
    --#{$prefix}card-cap-padding-y: #{$card-cap-padding-y};
    --#{$prefix}card-cap-padding-x: #{$card-cap-padding-x};
    --#{$prefix}card-cap-bg: #{$card-cap-bg};
    --#{$prefix}card-cap-color: #{$card-cap-color};
    --#{$prefix}card-height: #{$card-height};
    --#{$prefix}card-color: #{$card-color};
    --#{$prefix}card-bg: #{$card-bg};
    --#{$prefix}card-img-overlay-padding: #{$card-img-overlay-padding};
    --#{$prefix}card-group-margin: #{$card-group-margin};

    position: relative;

    display: flex;
    flex-direction: column;

    min-inline-size: 0; // See https://github.com/twbs/bootstrap/pull/22740#issuecomment-305868106
    block-size: var(--#{$prefix}card-height);
    border: var(--#{$prefix}card-border-width) solid
        var(--#{$prefix}card-border-color);

    color: var(--#{$prefix}body-color);
    overflow-wrap: break-word;

    background-color: var(--#{$prefix}card-bg);
    background-clip: border-box;

    @include border-radius(var(--#{$prefix}card-border-radius));
    @include box-shadow(var(--#{$prefix}card-box-shadow));

    & > hr {
        margin-inline: 0;
    }

    & > .list-group {
        border-top: inherit;
        border-bottom: inherit;

        &:first-child {
            border-top-width: 0;

            @include border-top-radius(
                var(--#{$prefix}card-inner-border-radius)
            );
        }

        &:last-child {
            border-bottom-width: 0;

            @include border-bottom-radius(
                var(--#{$prefix}card-inner-border-radius)
            );
        }
    }

    /* Due to specificity of the above selector (`.card > .list-group`), we must
    use a child selector here to prevent double borders. */
    > .card-header + .list-group,
    > .list-group + .card-footer {
        border-block-start: 0;
    }
}

.card-body {
    /* Enable `flex-grow: 1` for decks and groups so that card blocks take up
     as much space as possible, ensuring footers are aligned to the bottom. */
    flex: 1 1 auto;
    padding: var(--#{$prefix}card-spacer-y) var(--#{$prefix}card-spacer-x);
    color: var(--#{$prefix}card-color);
}

.card-title {
    margin-bottom: var(--#{$prefix}card-title-spacer-y);
    color: var(--#{$prefix}card-title-color);
}

.card-subtitle {
    margin-block: calc(-0.5 * var(--#{$prefix}card-title-spacer-y)) 0;
    color: var(--#{$prefix}card-subtitle-color);
}

.card-text:last-child {
    margin-block-end: 0;
}

.card-link {
    &:hover {
        text-decoration: if($link-hover-decoration == underline, none, null);
    }

    & + .card-link {
        margin-inline-start: var(--#{$prefix}card-spacer-x);
    }
}

/* Optional textual caps */
.card-header {
    margin-block-end: 0; // Removes the default margin-bottom of <hN>
    padding: var(--#{$prefix}card-cap-padding-y)
        var(--#{$prefix}card-cap-padding-x);
    border-bottom: var(--#{$prefix}card-border-width) solid
        var(--#{$prefix}card-border-color);

    color: var(--#{$prefix}card-cap-color);

    background-color: var(--#{$prefix}card-cap-bg);

    &:first-child {
        @include border-radius(
            var(--#{$prefix}card-inner-border-radius)
                var(--#{$prefix}card-inner-border-radius) 0 0
        );
    }
}

.card-footer {
    padding: var(--#{$prefix}card-cap-padding-y)
        var(--#{$prefix}card-cap-padding-x);
    border-top: var(--#{$prefix}card-border-width) solid
        var(--#{$prefix}card-border-color);
    color: var(--#{$prefix}card-cap-color);
    background-color: var(--#{$prefix}card-cap-bg);

    &:last-child {
        @include border-radius(
            0 0 var(--#{$prefix}card-inner-border-radius)
                var(--#{$prefix}card-inner-border-radius)
        );
    }
}

/* Header navs */
.card-header-tabs {
    margin-block-end: calc(-1 * var(--#{$prefix}card-cap-padding-y));
    margin-inline: calc(-0.5 * var(--#{$prefix}card-cap-padding-x));
    border-bottom: 0;

    .nav-link.active {
        border-bottom-color: var(--#{$prefix}card-bg);
        background-color: var(--#{$prefix}card-bg);
    }
}

.card-header-pills {
    margin-inline: calc(-0.5 * var(--#{$prefix}card-cap-padding-x));
}

// Card image
.card-img-overlay {
    position: absolute;
    inset: 0;
    padding: var(--#{$prefix}card-img-overlay-padding);

    @include border-radius(var(--#{$prefix}card-inner-border-radius));
}

.card-img,
.card-img-top,
.card-img-bottom {
    inline-size: 100%; // Required because we use flexbox and this inherently applies align-self: stretch
}

.card-img,
.card-img-top {
    @include border-top-radius(var(--#{$prefix}card-inner-border-radius));
}

.card-img,
.card-img-bottom {
    @include border-bottom-radius(var(--#{$prefix}card-inner-border-radius));
}

/* Card groups */
.card-group {
    /* The child selector allows nested `.card` within `.card-group`
     to display properly. */

    & > .card {
        margin-block-end: var(--#{$prefix}card-group-margin);
    }

    @include media-breakpoint-up(sm) {
        display: flex;
        flex-flow: row wrap;

        /* The child selector allows nested `.card` within `.card-group`
        to display properly. */
        & > .card {
            flex: 1 0 0;
            margin-block-end: 0;

            & + .card {
                margin-inline-start: 0;
                border-inline-start: 0;
            }

            /* Handle rounded corners */
            @if $enable-rounded {
                &:not(:last-child) {
                    @include border-end-radius(0);

                    & > .card-img-top,
                    & > .card-header {
                        border-start-end-radius: 0;
                    }

                    & > .card-img-bottom,
                    & > .card-footer {
                        border-end-end-radius: 0;
                    }
                }

                &:not(:first-child) {
                    @include border-start-radius(0);

                    & > .card-img-top,
                    & > .card-header {
                        border-start-start-radius: 0;
                    }

                    & > .card-img-bottom,
                    & > .card-footer {
                        border-end-start-radius: 0;
                    }
                }
            }
        }
    }
}
